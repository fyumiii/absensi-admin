<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Absensi Acara Administrator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'Inter', sans-serif; 
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%);
      background-size: 200% 200%;
      animation: gradientShift 8s ease infinite;
    }
    
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .slide-up { animation: slideUp 0.6s ease-out; }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .input-focus:focus {
      transform: translateY(-1px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(102, 126, 234, 0.25);
    }
    
    .dropdown-arrow {
      transition: transform 0.3s ease;
    }
    
    .dropdown-open .dropdown-arrow {
      transform: rotate(180deg);
    }
    
    select:focus {
      outline: none;
    }
  </style>
</head>
<body class="gradient-bg min-h-screen">
  <div class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md">
      <!-- Header -->
      <div class="text-center mb-8 slide-up">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl mb-4">
          <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
        </div>
        <h1 class="text-3xl font-bold text-white mb-2">Absensi Acara</h1>
        <p class="text-white/80">Subsie Administrator</p>
        <div class="w-16 h-0.5 bg-white/30 mx-auto mt-4"></div>
      </div>

      <!-- Quote Card -->
      <div class="glass-card rounded-2xl p-6 mb-6 text-center slide-up" style="animation-delay: 0.1s;">
        <p class="text-gray-700 font-medium" id="quoteText">"Kehadiran adalah bentuk komitmen terbaik"</p>
        <p class="text-gray-500 text-sm mt-2">- Tim Administrator</p>
      </div>

      <!-- Main Form -->
      <div class="glass-card rounded-2xl shadow-xl p-8 slide-up" style="animation-delay: 0.2s;">
        <form id="attendanceForm" class="space-y-6">
          <!-- Nama -->
          <div>
            <label for="nama" class="block text-sm font-semibold text-gray-700 mb-2">Nama Lengkap</label>
            <input type="text" id="nama" name="nama" required 
                   class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl bg-white/80 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300 input-focus"
                   placeholder="Masukkan nama lengkap">
          </div>
          
          <!-- Kelas Dropdown -->
          <div>
            <label for="kelas" class="block text-sm font-semibold text-gray-700 mb-2">Kelas</label>
            <div class="relative">
              <select id="kelas" name="kelas" required 
                      class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl bg-white/80 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300 input-focus appearance-none cursor-pointer">
                <option value="" disabled selected>Pilih kelas</option>
                <option value="X-E1">X-E1</option>
                <option value="X-E2">X-E2</option>
                <option value="X-E3">X-E3</option>
                <option value="X-E4">X-E4</option>
                <option value="X-E5">X-E5</option>
                <option value="X-E6">X-E6</option>
                <option value="X-E7">X-E7</option>
                <option value="X-E8">X-E8</option>
                <option value="X-E9">X-E9</option>
                <option value="X-E10">X-E10</option>
                <option value="X-E11">X-E11</option>
                <option value="X-E12">X-E12</option>
              </select>
              <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none">
                <svg class="w-5 h-5 text-gray-400 dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </div>
            </div>
          </div>
          
          <!-- No Absen -->
          <div>
            <label for="noAbsen" class="block text-sm font-semibold text-gray-700 mb-2">No Absen</label>
            <input type="number" id="noAbsen" name="noAbsen" required min="1" max="50"
                   class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl bg-white/80 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300 input-focus"
                   placeholder="Masukkan nomor absen">
          </div>
          
          <!-- Submit Button -->
          <button type="submit" class="w-full btn-primary text-white font-semibold py-3.5 px-6 rounded-xl shadow-lg">
            <span class="flex items-center justify-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
              </svg>
              Kirim Absensi
            </span>
          </button>
        </form>

        <!-- Success Message -->
        <div id="successMessage" class="hidden mt-6">
          <div class="p-4 bg-green-50 border border-green-200 rounded-xl">
            <div class="flex items-center">
              <div class="flex-shrink-0">
                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <div class="ml-3">
                <p class="text-green-800 font-semibold">Absensi berhasil dikirim!</p>
                <p class="text-green-700 text-sm">Terima kasih atas partisipasi Anda.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Stats -->
      
      

      <!-- Footer -->
      <div class="text-center mt-8 slide-up" style="animation-delay: 0.4s;">
        <p class="text-white/70 text-sm">Â© 2025 Subsie Administrator</p>
        <p class="text-white/50 text-xs mt-1">Sistem Absensi Digital</p>
      </div>
    </div>
  </div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2"

    const supabaseUrl = "https://yumlkrsknurpeqqdgjow.supabase.co"
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl1bWxrcnNrbnVycGVxcWRnam93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4Nzc4OTEsImV4cCI6MjA2OTQ1Mzg5MX0.uuZoj4K-lsohRYyZ-8c0n5iZtqtw3JDI9JPqVIjA4uk"
    const supabase = createClient(supabaseUrl, supabaseKey)

    const form = document.getElementById("attendanceForm")
    const successMessage = document.getElementById("successMessage")
    const attendanceCount = document.getElementById("attendanceCount")
    const quoteText = document.getElementById("quoteText")
    const kelasSelect = document.getElementById("kelas")

    // Professional quotes
    const quotes = [
      "Kehadiran adalah bentuk komitmen terbaik",
      "Administrasi yang baik adalah fondasi kesuksesan",
      "Setiap data adalah langkah menuju kemajuan",
      "Konsistensi menciptakan kepercayaan",
      "Teknologi mempermudah, dedikasi menyempurnakan",
      "Administrator handal, organisasi berkualitas"
    ]

    // Rotate quotes every 8 seconds
    let quoteIndex = 0
    setInterval(() => {
      quoteIndex = (quoteIndex + 1) % quotes.length
      quoteText.style.opacity = '0.5'
      setTimeout(() => {
        quoteText.textContent = `"${quotes[quoteIndex]}"`
        quoteText.style.opacity = '1'
      }, 300)
    }, 8000)

    // Add dropdown animation
    kelasSelect.addEventListener('focus', () => {
      kelasSelect.parentElement.classList.add('dropdown-open')
    })

    kelasSelect.addEventListener('blur', () => {
      kelasSelect.parentElement.classList.remove('dropdown-open')
    })

    // Get attendance count
    async function updateAttendanceCount() {
      try {
        const { count } = await supabase
          .from("absensi")
          .select("*", { count: 'exact', head: true })
        
        attendanceCount.textContent = count || 0
      } catch (error) {
        console.log('Error getting count:', error)
        attendanceCount.textContent = '0'
      }
    }

    // Load initial count
    updateAttendanceCount()

    // Form submission
    form.addEventListener("submit", async (e) => {
      e.preventDefault()
      
      const submitBtn = form.querySelector('button[type="submit"]')
      const originalHTML = submitBtn.innerHTML
      
      // Loading state
      submitBtn.innerHTML = `
        <span class="flex items-center justify-center">
          <svg class="w-5 h-5 mr-2 animate-spin" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Mengirim...
        </span>
      `
      submitBtn.disabled = true

      const nama = document.getElementById("nama").value.trim()
      const kelas = document.getElementById("kelas").value
      const no_absen = parseInt(document.getElementById("noAbsen").value)

      try {
        const { error } = await supabase.from("absensi").insert([{ nama, kelas, no_absen }])

        if (error) {
          throw error
        }

        // Success
        successMessage.classList.remove("hidden")
        successMessage.style.animation = "slideUp 0.5s ease-out"
        form.reset()
        updateAttendanceCount()

        // Hide success message after 5 seconds
        setTimeout(() => {
          successMessage.classList.add("hidden")
        }, 5000)

      } catch (error) {
        // Error handling
        const errorDiv = document.createElement('div')
        errorDiv.className = 'mt-4 p-4 bg-red-50 border border-red-200 rounded-xl'
        errorDiv.innerHTML = `
          <div class="flex items-center">
            <svg class="w-6 h-6 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
              <p class="text-red-800 font-semibold">Gagal mengirim absensi</p>
              <p class="text-red-700 text-sm">${error.message}</p>
            </div>
          </div>
        `
        form.appendChild(errorDiv)
        
        setTimeout(() => {
          errorDiv.remove()
        }, 5000)
      } finally {
        // Reset button
        submitBtn.innerHTML = originalHTML
        submitBtn.disabled = false
      }
    })
  </script>
</body>
</html>